!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/router"),require("@angular/common/http"),require("secure-web-storage"),require("crypto-js"),require("ngx-cookie-service"),require("ngx-spinner"),require("xml2js"),require("@angular/common")):"function"==typeof define&&define.amd?define("sso-telconet",["exports","@angular/core","@angular/router","@angular/common/http","secure-web-storage","crypto-js","ngx-cookie-service","ngx-spinner","xml2js","@angular/common"],t):t((e=e||self)["sso-telconet"]={},e.ng.core,e.ng.router,e.ng.common.http,e.secureWebStorage,e.cryptoJs,e.ngxCookieService,e.ngxSpinner,e.xml2js,e.ng.common)}(this,(function(e,t,o,r,i,n,s,c,a,u){"use strict";i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;function S(e,t,o,r){var i,n=arguments.length,s=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,r);else for(var c=e.length-1;c>=0;c--)(i=e[c])&&(s=(n<3?i(s):n>3?i(t,o,s):i(t,o))||s);return n>3&&s&&Object.defineProperty(t,o,s),s}var h=function(){function e(){this.secureStorage=new i(localStorage,{hash:function(e){return(e=n.SHA256(e,"T3lc0n3tC@sM@rL0n")).toString()},encrypt:function(e){return e=(e=n.AES.encrypt(e,"T3lc0n3tC@sM@rL0n")).toString()},decrypt:function(e){return e=(e=n.AES.decrypt(e,"T3lc0n3tC@sM@rL0n")).toString(n.enc.Utf8)}})}return e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e=S([t.Injectable({providedIn:"root"})],e)}(),p=function(){function e(e,t){this.storageService=e,this.cookieService=t,this.ssoSessionCok="SSO_SESSIONID",this.key="userSSO"}return e.prototype.setSession=function(e){this.storageService.secureStorage.setItem(this.key,e)},e.prototype.getSession=function(){try{return JSON.parse(this.storageService.secureStorage.getItem(this.key))}catch(e){return null}},e.prototype.clearSession=function(){this.storageService.secureStorage.clear()},e.prototype.getSsoSessionId=function(){return this.cookieService.get(this.ssoSessionCok)},e.prototype.setSsoSessionId=function(e){this.cookieService.set(this.ssoSessionCok,e,null,"/")},e.prototype.validateAuthSso=function(){return!(!this.getSession()||!this.getSsoSessionId())},e.ctorParameters=function(){return[{type:h},{type:s.CookieService}]},e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(h),t.ɵɵinject(s.CookieService))},token:e,providedIn:"root"}),e=S([t.Injectable({providedIn:"root"})],e)}(),g={production:!1,casServer:"https://sso.telconet.ec/cas",casServiceTarget:"http://localhost:4200/",casServiceCheck:"sso/check",casGatewayAutorizacion:"http://gw-cas.telconet.ec:9000/gateway/autorizacion",casGatewayAccounting:"http://gw-cas.telconet.ec:9000/check_sso"},l=function(){function e(e,t,o){this.router=e,this.http=t,this.secureStorage=o,this.casServerLogin=g.casServer.concat("/login"),this.casServiceTarget=g.casServiceTarget,this.casServicePath=g.casServiceTarget.concat(g.casServiceCheck),this.casValidateUrl=g.casServer.concat("/p3/serviceValidate"),this.casGatewayAutorizacion=g.casGatewayAutorizacion,this.casGatewayAccounting=g.casGatewayAccounting,this.httpHeaders=new r.HttpHeaders({sso:"true"})}return e.prototype.goToCAS=function(){this.removeData();var e=this.casServerLogin.concat("?service="+this.casServicePath);this.redirect(e)},e.prototype.removeData=function(){this.secureStorage.clearSession()},e.prototype.validateTicket=function(e){var t=this.casValidateUrl.concat("?service="+this.casServicePath+"&ticket="+e);return this.http.get(t,{headers:this.httpHeaders,responseType:"text"})},e.prototype.autorizacionSso=function(e){return this.http.post(this.casGatewayAutorizacion,e,{headers:this.httpHeaders})},e.prototype.redirect=function(e,t){return void 0===t&&(t="_parent"),new Promise((function(o,r){try{o(!!window.open(e,t))}catch(e){r(e)}}))},e.prototype.accounting=function(e){return this.http.post(this.casGatewayAccounting,e,{headers:this.httpHeaders})},e.ctorParameters=function(){return[{type:o.Router},{type:r.HttpClient},{type:p}]},e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(o.Router),t.ɵɵinject(r.HttpClient),t.ɵɵinject(p))},token:e,providedIn:"root"}),e=S([t.Injectable({providedIn:"root"})],e)}(),v=function(){},f=function(){function e(e,t){this.ssoService=e,this.secureStorage=t,this.casServiceTarget=g.casServiceTarget,this.accountingReq=new v}return e.prototype.canActivate=function(e,t){return!(!this.secureStorage.validateAuthSso()||!this.checkSessionCanActivate(t))||(this.ssoService.goToCAS(),!1)},e.prototype.canLoad=function(e,t){return!(!this.secureStorage.validateAuthSso()||!this.checkSessionCanLoad(e))||(this.ssoService.goToCAS(),!1)},e.prototype.checkSessionCanLoad=function(e){var t=this;return this.accountingReq.ssoSession=this.secureStorage.getSsoSessionId(),this.accountingReq.requestService="/"+e.path,this.accountingReq.path=this.casServiceTarget,this.accountingReq.ipCliente="127.0.0.1",this.ssoService.accounting(this.accountingReq).subscribe((function(e){null==e&&t.ssoService.goToCAS()})),!0},e.prototype.checkSessionCanActivate=function(e){var t=this;return this.accountingReq.ssoSession=this.secureStorage.getSsoSessionId(),this.accountingReq.requestService=e.url,this.accountingReq.path=this.casServiceTarget,this.accountingReq.ipCliente="127.0.0.1",this.ssoService.accounting(this.accountingReq).subscribe((function(e){null==e&&t.ssoService.goToCAS()})),!0},e.prototype.canActivateChild=function(e,t){return!(!this.secureStorage.validateAuthSso()||!this.checkSessionCanActivateChild(t))||(this.ssoService.goToCAS(),!1)},e.prototype.checkSessionCanActivateChild=function(e){var t=this;return this.accountingReq.ssoSession=this.secureStorage.getSsoSessionId(),this.accountingReq.requestService=e.url,this.accountingReq.path=this.casServiceTarget,this.accountingReq.ipCliente="127.0.0.1",this.ssoService.accounting(this.accountingReq).subscribe((function(e){null==e&&t.ssoService.goToCAS()})),!0},e.ctorParameters=function(){return[{type:l},{type:p}]},e.ɵprov=t.ɵɵdefineInjectable({factory:function(){return new e(t.ɵɵinject(l),t.ɵɵinject(p))},token:e,providedIn:"root"}),e=S([t.Injectable({providedIn:"root"})],e)}(),d=function(){function e(e,t){this.secureStorage=e,this.ssoService=t,this.casServiceTarget=g.casServiceTarget,this.accountingReq=new v}return e.prototype.intercept=function(e,t){var o=this;if("true"!==e.headers.get("sso")||!e.headers.get("sso")){var r="";"POST"===e.method&&(r="_ParametrosPost("+JSON.stringify(e.body)+")"),this.accountingReq.ssoSession=this.secureStorage.getSsoSessionId(),this.accountingReq.requestService=e.url.concat(r),this.accountingReq.path=this.casServiceTarget,this.accountingReq.ipCliente="127.0.0.1",this.ssoService.accounting(this.accountingReq).subscribe((function(e){null==e&&o.ssoService.goToCAS()}))}return t.handle(e)},e.ctorParameters=function(){return[{type:p},{type:l}]},e=S([t.Injectable()],e)}(),y=function(){},m=function(){},b=function(){},q=function(){function e(e,t,o,r,i){var n=this;this.route=e,this.router=t,this.ssoService=o,this.spinnerService=r,this.secureStorage=i,this.userSSO=new y,this.autorizacionReq=new m,this.casServiceTarget=g.casServiceTarget,this.route.queryParams.subscribe((function(e){n.ticket=e.ticket}))}return e.prototype.ngOnInit=function(){this.spinner(),this.validarTicket()},e.prototype.spinner=function(){this.spinnerService.show()},e.prototype.validarTicket=function(){var e=this;this.secureStorage.validateAuthSso()?this.router.navigate(["/"]):this.ssoService.validateTicket(this.ticket).subscribe((function(t){var o;t=t.replace(/cas:/g,""),a.parseString(t,(function(e,t){o=t.serviceResponse})),o.authenticationFailure?e.ssoService.goToCAS():(e.userSSO.username=o.authenticationSuccess[0].user[0],e.userSSO.cedula=o.authenticationSuccess[0].attributes[0].cedula[0],e.userSSO.nombreCompleto=o.authenticationSuccess[0].attributes[0].displayName[0],e.userSSO.correo=o.authenticationSuccess[0].attributes[0].mail[0],e.userSSO.nombres=o.authenticationSuccess[0].attributes[0].cn[0],e.userSSO.apellidos=o.authenticationSuccess[0].attributes[0].sn[0],e.userSSO.cargo=o.authenticationSuccess[0].attributes[0].cargo[0],e.userSSO.uidLdap=o.authenticationSuccess[0].attributes[0].uidNumber[0],e.secureStorage.setSession(JSON.stringify(e.userSSO)),e.autorizacionReq.userLogin=e.userSSO.username,e.autorizacionReq.serviceTarget=e.casServiceTarget,e.autorizacionReq.ipCliente="127.0.0.1",e.autorizacionReq.serviceTicket=e.ticket,e.ssoService.autorizacionSso(e.autorizacionReq).subscribe((function(t){t&&null==t.codError?e.secureStorage.setSsoSessionId(t.casSesionId):(e.ssoService.removeData(),alert("Existe un problema de conexión, Por favor comunicarse con el Departamento de Sistemas.")),e.router.navigate(["/"])})))}))},e.ctorParameters=function(){return[{type:o.ActivatedRoute},{type:o.Router},{type:l},{type:c.NgxSpinnerService},{type:p}]},e=S([t.Component({selector:"app-sso-check",template:'\n    <ngx-spinner bdColor="rgba(51,51,51,0.8)" size="large" color="#fff" type="ball-atom" [fullScreen]="true"></ngx-spinner>\n  ',styles:[""]})],e)}(),C=[{path:"sso/check",component:q}],R=function(){function e(){}return e=S([t.NgModule({imports:[o.RouterModule.forRoot(C)],exports:[o.RouterModule]})],e)}(),k=function(){function e(){}return e=S([t.NgModule({declarations:[q],imports:[u.CommonModule,R,c.NgxSpinnerModule],providers:[s.CookieService]})],e)}();e.AccountingSsoReq=v,e.AutorizacionSsoReq=m,e.AutorizacionSsoRes=b,e.SecureSessionCasService=p,e.SsoCheckComponent=q,e.SsoGuard=f,e.SsoInterceptor=d,e.SsoModule=k,e.SsoRoutingModule=R,e.SsoService=l,e.StorageService=h,e.UserSSO=y,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=sso-telconet.umd.min.js.map