{"version":3,"file":"sso-telconet.js","sources":["ng://sso-telconet/src/app/_service/storage.service.ts","ng://sso-telconet/src/app/_service/secure-session-cas.service.ts","ng://sso-telconet/src/environments/environment.ts","ng://sso-telconet/src/app/_service/sso.service.ts","ng://sso-telconet/src/app/_request/accounting-sso-req.ts","ng://sso-telconet/src/app/_guard/sso.guard.ts","ng://sso-telconet/src/app/_interceptor/sso.interceptor.ts","ng://sso-telconet/src/app/_model/user-sso.ts","ng://sso-telconet/src/app/_request/autorizacion-sso-req.ts","ng://sso-telconet/src/app/_response/autorizacion-sso-res.ts","ng://sso-telconet/src/app/sso-check/sso-check.component.ts","ng://sso-telconet/src/app/sso.routing.module.ts","ng://sso-telconet/src/app/sso.module.ts","ng://sso-telconet/sso-telconet.ts"],"sourcesContent":["import * as CryptoJS from 'crypto-js';\nimport {Injectable} from '@angular/core';\n\nconst SecureStorage = require('secure-web-storage');\nconst SECRET_KEY = 'T3lc0n3tC@sM@rL0n';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class StorageService {\n  constructor() {\n  }\n\n  public secureStorage = new SecureStorage(localStorage, {\n    hash: function hash(key) {\n      key = CryptoJS.SHA256(key, SECRET_KEY);\n      return key.toString();\n    }, encrypt: function encrypt(data) {\n      data = CryptoJS.AES.encrypt(data, SECRET_KEY);\n      data = data.toString();\n      return data;\n    }, decrypt: function decrypt(data) {\n      data = CryptoJS.AES.decrypt(data, SECRET_KEY);\n      data = data.toString(CryptoJS.enc.Utf8);\n      return data;\n    }\n  });\n}\n","import {Injectable} from '@angular/core';\nimport {StorageService} from './storage.service';\nimport {UserSSO} from '../_model/user-sso';\nimport {CookieService} from 'ngx-cookie-service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SecureSessionCasService {\n  constructor(private storageService: StorageService, private cookieService: CookieService) {\n  }\n\n  ssoSessionCok = 'SSO_SESSIONID';\n  key: string = 'userSSO';\n\n  setSession(value: string) {\n    this.storageService.secureStorage.setItem(this.key, value);\n  }\n\n  getSession(): UserSSO {\n    try {\n      return JSON.parse(this.storageService.secureStorage.getItem(this.key));\n    } catch (error) {\n      return null;\n    }\n  }\n\n  clearSession() {\n    this.storageService.secureStorage.clear();\n  }\n\n  getSsoSessionId() {\n    return this.cookieService.get(this.ssoSessionCok);\n  }\n\n  setSsoSessionId(value: string) {\n    this.cookieService.set(this.ssoSessionCok, value, null, '/');\n  }\n\n  /**\n   * Verifica si existe usuario autenticado\n   * @autor Marlon Plúas <mpluas@telconet.ec>\n   * @version 1.0\n   */\n  validateAuthSso() {\n    return !!(this.getSession() && this.getSsoSessionId());\n  }\n}\n","export const environment = {\n  production: false,\n  casServer: 'https://sso.telconet.ec/cas',\n  casServiceTarget: 'http://localhost:4200/',\n  casServiceCheck: 'sso/check',\n  casGatewayAutorizacion: 'http://gw-cas.telconet.ec:9000/gateway/autorizacion',\n  casGatewayAccounting: 'http://gw-cas.telconet.ec:9000/check_sso',\n};\n","import {Injectable} from '@angular/core';\nimport {Router} from '@angular/router';\nimport {HttpClient, HttpHeaders} from '@angular/common/http';\nimport {AutorizacionSsoReq} from '../_request/autorizacion-sso-req';\nimport {AutorizacionSsoRes} from '../_response/autorizacion-sso-res';\nimport {SecureSessionCasService} from './secure-session-cas.service';\nimport {AccountingSsoReq} from '../_request/accounting-sso-req';\nimport {environment} from '../../environments/environment';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SsoService {\n  casServerLogin = environment.casServer.concat('/login');\n  casServiceTarget = environment.casServiceTarget;\n  casServicePath = environment.casServiceTarget.concat(environment.casServiceCheck);\n  casValidateUrl = environment.casServer.concat('/p3/serviceValidate');\n  casGatewayAutorizacion = environment.casGatewayAutorizacion;\n  casGatewayAccounting = environment.casGatewayAccounting;\n\n  private httpHeaders = new HttpHeaders({\n    'sso': 'true'\n  });\n\n  constructor(private router: Router, private http: HttpClient, private secureStorage: SecureSessionCasService) {\n  }\n\n  /**\n   * Redirige al cas server\n   * @autor Marlon Plúas <mpluas@telconet.ec>\n   * @version 1.0\n   */\n  goToCAS() {\n    this.removeData();\n    const casUrlLogin = this.casServerLogin.concat('?service=' + this.casServicePath);\n    this.redirect(casUrlLogin);\n  }\n\n  /**\n   * Limpia datos de sesión existente\n   * @autor Marlon Plúas <mpluas@telconet.ec>\n   * @version 1.0\n   */\n  removeData() {\n    this.secureStorage.clearSession();\n  }\n\n  /**\n   * Valida el ticket recibido por cas server\n   * @autor Marlon Plúas <mpluas@telconet.ec>\n   * @version 1.0\n   *\n   * @param ticket\n   */\n  validateTicket(ticket: String) {\n    const casValidateTicket = this.casValidateUrl.concat('?service=' + this.casServicePath + '&ticket=' + ticket);\n    return this.http.get(casValidateTicket, {headers: this.httpHeaders, responseType: 'text'});\n  }\n\n  /**\n   * Valida si el usuario tiene autorización\n   * @autor Marlon Plúas <mpluas@telconet.ec>\n   * @version 1.0\n   *\n   * @param request\n   */\n  autorizacionSso(request: AutorizacionSsoReq) {\n    return this.http.post<AutorizacionSsoRes>(this.casGatewayAutorizacion, request, {headers: this.httpHeaders});\n  }\n\n  /**\n   * Método para redirigir a una pagina externa\n   * @autor Marlon Plúas <mpluas@telconet.ec>\n   * @version 1.0\n   *\n   * @param {string} url\n   * @param {string} target\n   * @returns {Promise<boolean>}\n   */\n  private redirect(url: string, target: string = '_parent'): Promise<boolean> {\n    return new Promise<boolean>((resolve, reject) => {\n      try {\n        resolve(!!window.open(url, target));\n      } catch (e) {\n        reject(e);\n      }\n    });\n  }\n\n  accounting(request: AccountingSsoReq) {\n    return this.http.post<any>(this.casGatewayAccounting, request, {headers: this.httpHeaders});\n  }\n}\n","export class AccountingSsoReq {\n\tssoSession: string;\n\trequestService: string;\n\tpath: string;\n\tipCliente: string;\n}\n","import {Injectable} from '@angular/core';\nimport {\n  CanActivate, ActivatedRouteSnapshot, RouterStateSnapshot, CanLoad, Route, UrlSegment, CanActivateChild\n} from '@angular/router';\nimport {SsoService} from '../_service/sso.service';\nimport {SecureSessionCasService} from '../_service/secure-session-cas.service';\nimport {AccountingSsoReq} from '../_request/accounting-sso-req';\nimport {environment} from '../../environments/environment';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SsoGuard implements CanActivate, CanLoad, CanActivateChild {\n  constructor(private ssoService: SsoService, private secureStorage: SecureSessionCasService) {\n  }\n\n  casServiceTarget = environment.casServiceTarget;\n  accountingReq: AccountingSsoReq = new AccountingSsoReq();\n\n  canActivate(next: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {\n    if (this.secureStorage.validateAuthSso() && this.checkSessionCanActivate(state)) {\n      return true;\n    }\n    // Si no existe user logeado se redirige al cas\n    this.ssoService.goToCAS();\n    return false;\n  }\n\n  canLoad(route: Route, segments: UrlSegment[]): boolean {\n    if (this.secureStorage.validateAuthSso() && this.checkSessionCanLoad(route)) {\n      return true;\n    }\n    // Si no existe user logeado se redirige al cas\n    this.ssoService.goToCAS();\n    return false;\n  }\n\n  private checkSessionCanLoad(route: Route) {\n    this.accountingReq.ssoSession = this.secureStorage.getSsoSessionId();\n    this.accountingReq.requestService = '/' + route.path;\n    this.accountingReq.path = this.casServiceTarget;\n    this.accountingReq.ipCliente = '127.0.0.1';\n    this.ssoService.accounting(this.accountingReq).subscribe(respose => {\n      if (respose == null) {\n        // Redirect al cas\n        this.ssoService.goToCAS();\n      }\n    });\n    return true;\n  }\n\n  private checkSessionCanActivate(route: RouterStateSnapshot) {\n    this.accountingReq.ssoSession = this.secureStorage.getSsoSessionId();\n    this.accountingReq.requestService = route.url;\n    this.accountingReq.path = this.casServiceTarget;\n    this.accountingReq.ipCliente = '127.0.0.1';\n    this.ssoService.accounting(this.accountingReq).subscribe(respose => {\n      if (respose == null) {\n        // Redirect al cas\n        this.ssoService.goToCAS();\n      }\n    });\n    return true;\n  }\n\n  canActivateChild(childRoute: ActivatedRouteSnapshot, state: RouterStateSnapshot): boolean {\n    if (this.secureStorage.validateAuthSso() && this.checkSessionCanActivateChild(state)) {\n      return true;\n    }\n    // Si no existe user logeado se redirige al cas\n    this.ssoService.goToCAS();\n    return false;\n  }\n\n  private checkSessionCanActivateChild(route: RouterStateSnapshot) {\n    this.accountingReq.ssoSession = this.secureStorage.getSsoSessionId();\n    this.accountingReq.requestService = route.url;\n    this.accountingReq.path = this.casServiceTarget;\n    this.accountingReq.ipCliente = '127.0.0.1';\n    this.ssoService.accounting(this.accountingReq).subscribe(respose => {\n      if (respose == null) {\n        // Redirect al cas\n        this.ssoService.goToCAS();\n      }\n    });\n    return true;\n  }\n}\n","import {Injectable} from '@angular/core';\nimport {\n  HttpRequest, HttpHandler, HttpEvent, HttpInterceptor\n} from '@angular/common/http';\nimport {Observable} from 'rxjs';\nimport {SecureSessionCasService} from '../_service/secure-session-cas.service';\nimport {AccountingSsoReq} from '../_request/accounting-sso-req';\nimport {SsoService} from '../_service/sso.service';\nimport {environment} from '../../environments/environment';\n\n@Injectable()\nexport class SsoInterceptor implements HttpInterceptor {\n  casServiceTarget = environment.casServiceTarget;\n  accountingReq: AccountingSsoReq = new AccountingSsoReq();\n\n  constructor(private secureStorage: SecureSessionCasService, private ssoService: SsoService) {\n  }\n\n  intercept(request: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\n    if (request.headers.get('sso') !== 'true' || !request.headers.get('sso')) {\n      let parametrosPost = '';\n      if (request.method === 'POST') {\n        parametrosPost = '_ParametrosPost(' + JSON.stringify(request.body) + ')';\n      }\n      this.accountingReq.ssoSession = this.secureStorage.getSsoSessionId();\n      this.accountingReq.requestService = request.url.concat(parametrosPost);\n      this.accountingReq.path = this.casServiceTarget;\n      this.accountingReq.ipCliente = '127.0.0.1';\n      this.ssoService.accounting(this.accountingReq).subscribe(respose => {\n        if (respose == null) {\n          // Redirect al cas\n          this.ssoService.goToCAS();\n        }\n      });\n    }\n    return next.handle(request);\n  }\n}\n","export class UserSSO {\n\tusername: string;\n\tcedula: string;\n\tnombreCompleto: string;\n\tcorreo: string;\n\tcargo: string;\n\tnombres: string;\n\tapellidos: string;\n\tuidLdap: string;\n}\n","export class AutorizacionSsoReq {\n\tuserLogin: string;\n\tserviceTarget: string;\n\tipCliente: string;\n\tserviceTicket: string;\n}\n","export class AutorizacionSsoRes {\n  casSesionId: string;\n  codError: string;\n  roles: string[];\n}\n","import {Component, OnInit} from '@angular/core';\nimport {NgxSpinnerService} from 'ngx-spinner';\nimport {ActivatedRoute, Router} from '@angular/router';\nimport {SsoService} from '../_service/sso.service';\nimport * as xml2js from 'xml2js';\nimport {UserSSO} from '../_model/user-sso';\nimport {AutorizacionSsoReq} from '../_request/autorizacion-sso-req';\nimport {SecureSessionCasService} from '../_service/secure-session-cas.service';\nimport {environment} from '../../environments/environment';\n\n@Component({\n  selector: 'app-sso-check',\n  template: `\n    <ngx-spinner bdColor=\"rgba(51,51,51,0.8)\" size=\"large\" color=\"#fff\" type=\"ball-atom\" [fullScreen]=\"true\"></ngx-spinner>\n  `, styles: ['']\n})\nexport class SsoCheckComponent implements OnInit {\n  userSSO: UserSSO = new UserSSO();\n  autorizacionReq: AutorizacionSsoReq = new AutorizacionSsoReq();\n  casServiceTarget = environment.casServiceTarget;\n  ticket: string;\n\n  constructor(private route: ActivatedRoute,\n              private router: Router,\n              private ssoService: SsoService,\n              private spinnerService: NgxSpinnerService,\n              private secureStorage: SecureSessionCasService) {\n    this.route.queryParams.subscribe(params => {\n      this.ticket = params.ticket;\n    });\n  }\n\n  ngOnInit(): void {\n    this.spinner();\n    this.validarTicket();\n  }\n\n  spinner() {\n    this.spinnerService.show();\n  }\n\n  /**\n   * Método que valida el ticket SSO\n   * @autor Marlon Plúas <mpluas@telconet.ec>\n   * @version 1.0\n   */\n  validarTicket() {\n    if (this.secureStorage.validateAuthSso()) {\n      this.router.navigate(['/']);\n    } else {\n      this.ssoService.validateTicket(this.ticket).subscribe(response => {\n        response = response.replace(/cas:/g, '');\n        let res;\n        xml2js.parseString(response, (error, result) => {\n          res = result.serviceResponse;\n        });\n        if (res.authenticationFailure) {\n          this.ssoService.goToCAS();\n        } else {\n          this.userSSO.username = res.authenticationSuccess[0].user[0];\n          this.userSSO.cedula = res.authenticationSuccess[0].attributes[0].cedula[0];\n          this.userSSO.nombreCompleto = res.authenticationSuccess[0].attributes[0].displayName[0];\n          this.userSSO.correo = res.authenticationSuccess[0].attributes[0].mail[0];\n          this.userSSO.nombres = res.authenticationSuccess[0].attributes[0].cn[0];\n          this.userSSO.apellidos = res.authenticationSuccess[0].attributes[0].sn[0];\n          this.userSSO.cargo = res.authenticationSuccess[0].attributes[0].cargo[0];\n          this.userSSO.uidLdap = res.authenticationSuccess[0].attributes[0].uidNumber[0];\n          this.secureStorage.setSession(JSON.stringify(this.userSSO));\n          this.autorizacionReq.userLogin = this.userSSO.username;\n          this.autorizacionReq.serviceTarget = this.casServiceTarget;\n          this.autorizacionReq.ipCliente = '127.0.0.1';\n          this.autorizacionReq.serviceTicket = this.ticket;\n          this.ssoService.autorizacionSso(this.autorizacionReq).subscribe(response => {\n            if (!response || response.codError != null) {\n              this.ssoService.removeData();\n              alert('Existe un problema de conexión, Por favor comunicarse con el Departamento de Sistemas.');\n            } else {\n              this.secureStorage.setSsoSessionId(response.casSesionId);\n            }\n            this.router.navigate(['/']);\n          });\n        }\n      });\n    }\n  }\n}\n","import {NgModule} from '@angular/core';\nimport {Routes, RouterModule} from '@angular/router';\nimport {SsoCheckComponent} from './sso-check/sso-check.component';\n\nconst routes: Routes = [\n  {path: 'sso/check', component: SsoCheckComponent}\n];\n\n@NgModule({\n  imports: [RouterModule.forRoot(routes)],\n  exports: [RouterModule]\n})\nexport class SsoRoutingModule {\n}\n","import {NgModule} from '@angular/core';\nimport {CommonModule} from '@angular/common';\nimport {SsoRoutingModule} from './sso.routing.module';\nimport {SsoCheckComponent} from './sso-check/sso-check.component';\nimport {CookieService} from 'ngx-cookie-service';\nimport {NgxSpinnerModule} from 'ngx-spinner';\n\n@NgModule({\n  declarations: [SsoCheckComponent], imports: [\n    CommonModule, SsoRoutingModule, NgxSpinnerModule\n  ], providers: [CookieService]\n})\nexport class SsoModule {\n}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public_api';\n"],"names":["SecureStorage","CryptoJS.SHA256","CryptoJS.AES","CryptoJS.enc","xml2js.parseString"],"mappings":"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"}